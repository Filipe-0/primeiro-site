<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cyber Runner — Jogo 2D</title>
<style>
  :root{
    --bg:#091016;
    --panel:#07121a;
    --accent:#00f0ff;
    --accent2:#ff3d81;
    --text:#dcecff;
    --muted:#7aa2b8;
    --glass: rgba(255,255,255,0.04);
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#05060a 0%, #08111a 60%); color:var(--text); -webkit-font-smoothing:antialiased;}
  .wrap{display:grid;grid-template-columns:1fr 320px; gap:18px; padding:18px; height:100vh; box-sizing:border-box;}
  @media (max-width:900px){ .wrap{grid-template-columns:1fr; grid-template-rows: auto 260px;} .sidebar{height:260px;} }
  .game-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); border-radius:12px; padding:12px; box-shadow: 0 6px 30px rgba(0,0,0,0.6); display:flex; flex-direction:column; }
  .canvas-wrap{position:relative;flex:1; border-radius:8px; overflow:hidden; background: linear-gradient(180deg,#0b1320,#07101a);}
  canvas{display:block; width:100%; height:100%;}
  .hud{position:absolute; left:12px; top:12px; z-index:50; display:flex; gap:8px; align-items:center;}
  .panel{background:var(--glass); padding:8px 10px; border-radius:8px; backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,0.03);}
  .panel h4{margin:0;font-size:12px;color:var(--muted); font-weight:600;}
  .panel p{margin:0;font-weight:700;font-size:14px;}
  .right-controls{position:absolute; right:12px; top:12px; z-index:60; display:flex; gap:8px;}
  button.btn{background:transparent;color:var(--text); border:1px solid rgba(255,255,255,0.06); padding:8px 10px;border-radius:8px; cursor:pointer; font-weight:700;}
  button.btn:hover{transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,0.6);}
  .sidebar{width:320px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); border-radius:12px; padding:12px; box-shadow:0 6px 30px rgba(0,0,0,0.6); overflow:auto;}
  .title{display:flex; gap:12px; align-items:center; margin-bottom:10px;}
  .logo{width:52px;height:52px;border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex;align-items:center;justify-content:center;font-weight:900;color:#021; font-size:18px;}
  .menu{display:flex; gap:8px; margin-bottom:10px;}
  .menu .item{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer;}
  .player-panel{margin-bottom:14px;}
  .chat{background:rgba(0,0,0,0.12); border-radius:8px;padding:8px; height:160px; display:flex; flex-direction:column; gap:6px; overflow:auto; border:1px solid rgba(255,255,255,0.02);}
  .chat .msg{font-size:13px; color:var(--muted);}
  .chat-input{display:flex; gap:8px; margin-top:8px;}
  input[type="text"]{flex:1; padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04); background:transparent;color:var(--text);}
  .controls{display:flex; gap:8px; margin-top:10px; justify-content:center;}
  .touch-controls{position:absolute; left:12px; bottom:12px; z-index:70; display:flex; gap:8px; align-items:center;}
  .pad-btn{width:56px;height:56px;border-radius:12px;border:1px solid rgba(255,255,255,0.04); background:rgba(0,0,0,0.16); display:flex;align-items:center;justify-content:center; font-weight:800;}
  footer{margin-top:12px;font-size:12px;color:var(--muted); text-align:center;}
  /* small visual effects */
  .glow{box-shadow:0 6px 24px rgba(0,240,255,0.06), inset 0 0 18px rgba(0,240,255,0.02);}
  .big-score{font-size:22px;font-weight:900;color:var(--accent2); text-shadow:0 6px 30px rgba(255,61,129,0.06);}
</style>
</head>
<body>
<div class="wrap">
  <div class="game-card">
    <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px;">
      <div style="font-weight:900; font-size:18px;">Cyber Runner</div>
      <div style="color:var(--muted); font-size:13px;">— corredor 2D, tema cyberpunk</div>
    </div>

    <div class="canvas-wrap" id="gameArea">
      <canvas id="gameCanvas" width="1280" height="720"></canvas>

      <div class="hud">
        <div class="panel">
          <h4>Vida</h4>
          <p id="hpText">100%</p>
        </div>
        <div class="panel">
          <h4>Pontos</h4>
          <p id="scoreText">0</p>
        </div>
        <div class="panel">
          <h4>Tempo</h4>
          <p id="timeText">0s</p>
        </div>
      </div>

      <div class="right-controls">
        <button id="btnPause" class="btn">Pausar</button>
        <button id="btnRestart" class="btn">Reiniciar</button>
        <button id="btnFull" class="btn">Tela Cheia</button>
      </div>

      <!-- touch buttons -->
      <div class="touch-controls" id="touchControls" style="display:none;">
        <div class="pad-btn" id="leftBtn">◀</div>
        <div class="pad-btn" id="jumpBtn">▲</div>
        <div class="pad-btn" id="rightBtn">▶</div>
        <div class="pad-btn" id="shootBtn">FIRE</div>
      </div>
    </div>

    <div style="display:flex; gap:8px; margin-top:10px; align-items:center;">
      <div class="big-score" id="bigScore">Score: 0</div>
      <div style="flex:1"></div>
      <div style="color:var(--muted); font-size:13px;">Use ← → para mover, Espaço para pular, Z para atirar</div>
    </div>
  </div>

  <aside class="sidebar">
    <div class="title">
      <div class="logo">CR</div>
      <div>
        <div style="font-weight:900;">Painel do Jogador</div>
        <div style="font-size:13px;color:var(--muted);">Tema: Cyberpunk • Versão: 1.0</div>
      </div>
    </div>

    <div class="menu">
      <div class="item" id="menuStats">Estatísticas</div>
      <div class="item" id="menuShop">Loja</div>
      <div class="item" id="menuSettings">Configurações</div>
    </div>

    <div class="player-panel panel">
      <h4>Nome</h4>
      <p id="playerName">Jogador</p>
      <h4>Nível</h4>
      <p id="playerLevel">1</p>
    </div>

    <div>
      <h4 style="margin:8px 0 6px 0;">Chat (local)</h4>
      <div class="chat" id="chatBox"></div>
      <div class="chat-input">
        <input id="chatInput" type="text" placeholder="Diga algo...">
        <button id="sendChat" class="btn">Enviar</button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <h4 style="margin:8px 0 6px 0;">Música & Efeitos</h4>
      <div style="display:flex; gap:8px;">
        <button id="toggleMusic" class="btn">Música On</button>
        <button id="toggleSfx" class="btn">SFX On</button>
      </div>
    </div>

    <footer>
      Desenvolvido por você • Experimente modificar o código!
    </footer>
  </aside>
</div>

<script>
/* -----------------------------
  Jogo: Cyber Runner (2D) - JavaScript
  Todo código roda sem arquivos externos.
------------------------------*/

// Canvas & context
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Resize canvas to maintain aspect ratio responsively
function fitCanvas() {
  const wrap = document.getElementById('gameArea');
  const w = wrap.clientWidth;
  const h = wrap.clientHeight;
  const ratio = 16/9;
  let cw = w, ch = w/ratio;
  if (ch > h) { ch = h; cw = h*ratio; }
  canvas.style.width = cw + 'px';
  canvas.style.height = ch + 'px';
}
window.addEventListener('resize', fitCanvas);
fitCanvas();

// Game state
let running = true;
let paused = false;
let last = performance.now();
let dtAccum = 0;
let elapsed = 0;
let score = 0;
let hp = 100;

// Input
const keys = {};
window.addEventListener('keydown',(e)=>{ keys[e.key.toLowerCase()] = true; if(e.key===' '){ e.preventDefault(); }});
window.addEventListener('keyup',(e)=>{ keys[e.key.toLowerCase()] = false; });

// Touch controls detection
function isMobile() {
  return /Mobi|Android|iPhone|iPad/.test(navigator.userAgent);
}
if(isMobile()){
  document.getElementById('touchControls').style.display = 'flex';
}

// Fullscreen
document.getElementById('btnFull').onclick = () => {
  if(!document.fullscreenElement) document.documentElement.requestFullscreen().catch(()=>{});
  else document.exitFullscreen();
};

// Pause/Restart
document.getElementById('btnPause').onclick = () => {
  paused = !paused;
  document.getElementById('btnPause').textContent = paused ? 'Continuar' : 'Pausar';
};
document.getElementById('btnRestart').onclick = resetGame;

// Chat local
const chatBox = document.getElementById('chatBox');
document.getElementById('sendChat').onclick = sendChat;
document.getElementById('chatInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendChat(); });
function sendChat(){
  const t = document.getElementById('chatInput').value.trim();
  if(!t) return;
  const el = document.createElement('div'); el.className='msg'; el.textContent = 'Você: ' + t;
  chatBox.appendChild(el);
  chatBox.scrollTop = chatBox.scrollHeight;
  document.getElementById('chatInput').value='';
}

/* ----------- Audio: WebAudio synth (no arquivos) -------------- */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let musicOn = true, sfxOn = true;
document.getElementById('toggleMusic').onclick = async () => {
  if (audioCtx.state === 'suspended') await audioCtx.resume();
  musicOn = !musicOn;
  document.getElementById('toggleMusic').textContent = musicOn ? 'Música On' : 'Música Off';
};
document.getElementById('toggleSfx').onclick = () => { sfxOn = !sfxOn; document.getElementById('toggleSfx').textContent = sfxOn ? 'SFX On' : 'SFX Off'; };

function playBeep(freq=440, time=0.08, type='sine', gain=0.08){
  if(!sfxOn) return;
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + time);
  setTimeout(()=>o.stop(), (time+0.02)*1000);
}

// Simple looping background music (chords)
let musicNode = null;
function startMusic(){
  if(!musicOn) return;
  if(musicNode) return;
  const master = audioCtx.createGain(); master.gain.value = 0.04; master.connect(audioCtx.destination);
  const notes = [220, 277.18, 329.63, 415.30]; // simple chord arpeggio
  let i = 0;
  musicNode = setInterval(()=> {
    const o = audioCtx.createOscillator();
    o.type='sawtooth';
    o.frequency.value = notes[i%notes.length];
    const g = audioCtx.createGain(); g.gain.value = 0.1;
    o.connect(g); g.connect(master);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
    setTimeout(()=>o.stop(), 520);
    i++;
  }, 300);
}
function stopMusic(){ if(musicNode){ clearInterval(musicNode); musicNode=null; } }
setInterval(()=>{ if(musicOn) startMusic(); else stopMusic(); }, 500);

/* ---------------- Entity system ----------------- */
class Vec { constructor(x=0,y=0){this.x=x; this.y=y;} }
class Player {
  constructor(){
    this.pos = new Vec(150, 450);
    this.vel = new Vec(0,0);
    this.size = {w:48,h:56};
    this.onGround = false;
    this.cool = 0; // shooting cooldown
    this.alive = true;
  }
  update(dt){
    // controls
    const speed = 260;
    if(keys['arrowleft']||keys['a']) this.vel.x = -speed;
    else if(keys['arrowright']||keys['d']) this.vel.x = speed;
    else this.vel.x = 0;
    // jump
    if((keys[' ']||keys['w']||keys['arrowup']) && this.onGround){
      this.vel.y = -540; this.onGround=false; playBeep(880,0.12,'triangle',0.06);
    }
    // gravity
    this.vel.y += 1600*dt;
    // pos
    this.pos.x += this.vel.x*dt;
    this.pos.y += this.vel.y*dt;
    // ground collision
    const groundY = world.groundY(this.pos.x);
    if(this.pos.y + this.size.h/2 >= groundY){
      this.pos.y = groundY - this.size.h/2;
      this.vel.y = 0; this.onGround = true;
    }
    // bounds
    if(this.pos.x < 30) this.pos.x = 30;
    if(this.pos.x > world.width - 30) this.pos.x = world.width - 30;
    // shoot
    if((keys['z']||keys['x']) && this.cool <= 0){
      spawnBullet(this.pos.x + this.size.w/2, this.pos.y, 800);
      this.cool = 0.28; playBeep(1200,0.06,'square',0.06);
    }
    this.cool -= dt;
  }
  draw(c){
    // body
    c.save();
    c.translate(this.pos.x, this.pos.y);
    // glow
    c.shadowColor = 'rgba(0,255,255,0.16)';
    c.shadowBlur = 18;
    // torso
    c.fillStyle = '#011621';
    c.fillRect(-this.size.w/2, -this.size.h/2, this.size.w, this.size.h);
    // visor
    c.fillStyle = 'linear-gradient(#00f0ff,#ff3d81)';
    c.fillStyle = 'rgba(0,240,255,0.9)';
    c.fillRect(-this.size.w/2 + 6, -this.size.h/2 + 8, this.size.w - 12, 12);
    // legs
    c.fillStyle = '#022';
    c.fillRect(-this.size.w/2 + 6, 0, 16, 18);
    c.fillRect(-this.size.w/2 + 26, 0, 16, 18);
    c.restore();
  }
}

class Bullet {
  constructor(x,y,speed){
    this.pos = new Vec(x,y-10);
    this.vx = speed;
    this.radius = 6;
    this.life = 2;
  }
  update(dt){
    this.pos.x += this.vx * dt;
    this.life -= dt;
  }
  draw(c){
    c.save();
    c.beginPath();
    c.fillStyle = 'rgba(255,220,80,0.95)';
    c.arc(this.pos.x, this.pos.y, this.radius, 0, Math.PI*2);
    c.fill();
    c.restore();
  }
}

class Enemy {
  constructor(x,y,type=0){
    this.pos = new Vec(x,y);
    this.vx = -100 - Math.random()*120;
    this.size = {w:40,h:44};
    this.type = type;
    this.hp = type===0 ? 20 : 40;
  }
  update(dt){
    this.pos.x += this.vx*dt;
    // simple gravity to ground
    const gY = world.groundY(this.pos.x);
    if(this.pos.y + this.size.h/2 < gY) this.pos.y += 400*dt;
    else this.pos.y = gY - this.size.h/2;
  }
  draw(c){
    c.save();
    c.translate(this.pos.x,this.pos.y);
    c.fillStyle = this.type===0 ? '#ff5a6e' : '#ffb86b';
    c.fillRect(-this.size.w/2,-this.size.h/2,this.size.w,this.size.h);
    c.fillStyle='rgba(0,0,0,0.12)'; c.fillRect(-12,-8,24,12);
    c.restore();
  }
}

/* ---------- World & utilities ----------- */
const world = {
  width: 3000,
  scrollX: 0,
  speed: 120,
  layers: [
    {par:0.2, color1:'#06070a', color2:'#081018'},
    {par:0.5, color1:'#07121a', color2:'#071326'},
    {par:0.9, color1:'#081426', color2:'#061019'}
  ],
  groundY: function(x){
    // make a slightly wavy ground
    return 560 + Math.sin(x*0.005)*20;
  }
};

let player = new Player();
const bullets = [];
const enemies = [];
const particles = [];

/* spawn */
function spawnEnemy(){
  const x = world.scrollX + canvas.width + 80 + Math.random()*400;
  const y = world.groundY(x) - 22;
  enemies.push(new Enemy(x,y, Math.random()<0.85?0:1));
}
function spawnBullet(x,y,speed){
  bullets.push(new Bullet(x,y,speed));
}

/* particles for hits */
function spawnParticles(x,y, count=8){
  for(let i=0;i<count;i++){
    particles.push({
      pos:new Vec(x,y),
      vx:(Math.random()-0.5)*300,
      vy:(Math.random()-0.8)*300,
      life:0.6+Math.random()*0.6,
      r:2+Math.random()*3,
      col: 'rgba(255,180,100,'+(0.8+Math.random()*0.2)+')'
    });
  }
}

/* collisions */
function rectOverlap(aX,aY,aW,aH,bX,bY,bW,bH){
  return !(aX+aW < bX || aX > bX+bW || aY+aH < bY || aY > bY+bH);
}

/* game loop */
let spawnTimer = 0;
function update(dt){
  if(paused) return;
  elapsed += dt;
  // player update
  player.update(dt);
  // auto scroll world
  world.scrollX += world.speed * dt;
  // update bullets
  for(let i=bullets.length-1;i>=0;i--){
    bullets[i].update(dt);
    if(bullets[i].life<=0 || bullets[i].pos.x > world.scrollX + canvas.width + 200) bullets.splice(i,1);
  }
  // enemies
  spawnTimer -= dt;
  if(spawnTimer <= 0){
    spawnTimer = 1.4 - Math.min(1.1, Math.floor(elapsed/15)*0.05);
    spawnEnemy();
  }
  for(let i=enemies.length-1;i>=0;i--){
    const e = enemies[i];
    e.update(dt);
    // collision bullet -> enemy
    for(let j=bullets.length-1;j>=0;j--){
      const b = bullets[j];
      if(rectOverlap(e.pos.x - e.size.w/2, e.pos.y - e.size.h/2, e.size.w, e.size.h, b.pos.x - b.radius, b.pos.y - b.radius, b.radius*2, b.radius*2)){
        e.hp -= 20; bullets.splice(j,1); spawnParticles(b.pos.x, b.pos.y, 10); score += 12; playBeep(900,0.04,'sine',0.06);
      }
    }
    // if enemy off-screen left -> remove
    if(e.pos.x < world.scrollX - 200) enemies.splice(i,1);
    if(e.hp <= 0){
      spawnParticles(e.pos.x, e.pos.y, 18); enemies.splice(i,1); score += 40; playBeep(300,0.12,'sawtooth',0.06);
    }
    // enemy collides with player
    if(rectOverlap(e.pos.x - e.size.w/2, e.pos.y - e.size.h/2, e.size.w, e.size.h, player.pos.x - player.size.w/2, player.pos.y - player.size.h/2, player.size.w, player.size.h)){
      enemies.splice(i,1);
      hp -= 18;
      spawnParticles(player.pos.x, player.pos.y, 20);
      playBeep(120,0.18,'sine',0.12);
      if(hp <= 0){ player.alive=false; running=false; }
    }
  }
  // particles update
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.vy += 1400*dt;
    p.pos.x += p.vx*dt; p.pos.y += p.vy*dt;
    p.life -= dt;
    if(p.life <= 0) particles.splice(i,1);
  }

  // world bound clamp score
  score += dt * 1.0; // passive score
  // UI updates
  document.getElementById('scoreText').textContent = Math.floor(score);
  document.getElementById('bigScore').textContent = 'Score: ' + Math.floor(score);
  document.getElementById('hpText').textContent = Math.max(0,Math.floor(hp)) + '%';
  document.getElementById('timeText').textContent = Math.floor(elapsed) + 's';
}

/* draw everything */
function draw(){
  // clear
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  // parallax layers
  for(let i=0;i<world.layers.length;i++){
    const layer = world.layers[i];
    const par = layer.par;
    // simple horizontal gradient stripes
    ctx.fillStyle = layer.color1;
    ctx.fillRect(0, i*30, W, H);
    // moving rects
    ctx.globalAlpha = 0.9;
    for(let j=-1;j<6;j++){
      const x = -((world.scrollX*par)%400) + j*400;
      ctx.fillStyle = i===0 ? 'rgba(2,6,8,0.12)' : (i===1 ? 'rgba(0,20,30,0.08)' : 'rgba(10,18,26,0.06)');
      ctx.fillRect(x, 60 + i*40, 220, 26);
    }
    ctx.globalAlpha = 1;
  }

  // ground
  ctx.fillStyle = '#04121a';
  ctx.fillRect(0, 560, W, H-560);

  // draw player relative to world scroll
  ctx.save();
  const px = player.pos.x - world.scrollX;
  player.draw(ctx);

  // draw bullets
  for(const b of bullets) b.draw(ctx);

  // draw enemies
  for(const e of enemies){
    ctx.save();
    // convert enemy world x to canvas x
    const ex = e.pos.x - world.scrollX;
    e.draw(ctx);
    ctx.restore();
    // draw HP bar over enemy
    const exCanvas = e.pos.x - world.scrollX;
    ctx.fillStyle = 'rgba(0,0,0,0.4)';
    ctx.fillRect(exCanvas - 20, e.pos.y - e.size.h/2 - 12, 40, 6);
    ctx.fillStyle = '#ff6b6b';
    ctx.fillRect(exCanvas - 20, e.pos.y - e.size.h/2 - 12, 40 * (e.hp / (e.type===0?20:40)), 6);
  }

  // particles
  for(const p of particles){
    ctx.beginPath();
    ctx.fillStyle = p.col;
    ctx.arc(p.pos.x - world.scrollX, p.pos.y, p.r, 0, Math.PI*2);
    ctx.fill();
  }

  // HUD decorative overlay
  ctx.restore();

  // if paused overlay
  if(paused){
    ctx.fillStyle = 'rgba(4,8,12,0.6)';
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle = 'white';
    ctx.font = '36px monospace';
    ctx.fillText('PAUSADO', W/2 - 80, H/2);
  }
  // if game over
  if(!running){
    ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle = '#ff5a6e';
    ctx.font = '48px monospace';
    ctx.fillText('GAME OVER', W/2 - 150, H/2 - 20);
    ctx.fillStyle = 'white';
    ctx.font = '22px monospace';
    ctx.fillText('Clique em Reiniciar para tentar de novo', W/2 - 230, H/2 + 20);
  }
}

/* main loop */
function loop(ts){
  const now = ts;
  let dt = Math.min(0.05, (now - last)/1000);
  last = now;
  if(!paused && running){ update(dt); }
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* restart */
function resetGame(){
  // reset state
  running = true; paused = false; elapsed = 0; score = 0; hp = 100;
  player = new Player(); bullets.length=0; enemies.length=0; particles.length=0;
  document.getElementById('btnPause').textContent = 'Pausar';
  // populate a few enemies
  for(let i=0;i<3;i++) spawnEnemy();
}

/* initial population */
for(let i=0;i<2;i++) spawnEnemy();

/* touch buttons handling */
['leftBtn','rightBtn','jumpBtn','shootBtn'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('touchstart', (e)=>{ e.preventDefault(); touchDown(id); });
  el.addEventListener('touchend', (e)=>{ e.preventDefault(); touchUp(id); });
  el.addEventListener('mousedown', ()=>touchDown(id));
  el.addEventListener('mouseup', ()=>touchUp(id));
});
function touchDown(id){
  if(id==='leftBtn') keys['arrowleft']=true;
  if(id==='rightBtn') keys['arrowright']=true;
  if(id==='jumpBtn') keys[' ']=true;
  if(id==='shootBtn') keys['z']=true;
}
function touchUp(id){
  if(id==='leftBtn') keys['arrowleft']=false;
  if(id==='rightBtn') keys['arrowright']=false;
  if(id==='jumpBtn') keys[' ']=false;
  if(id==='shootBtn') keys['z']=false;
}

/* small UX: clicking canvas resumes audio if needed */
canvas.addEventListener('click', async () => {
  if(audioCtx.state === 'suspended') await audioCtx.resume();
});

/* auto show touch if small */
(function checkTouchVisibility(){ if(isMobile()) document.getElementById('touchControls').style.display='flex'; else document.getElementById('touchControls').style.display='none'; })();

/* make sure canvas internal resolution matches layout for crispness */
function adaptResolution(){
  const ratio = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width * ratio;
  canvas.height = rect.height * ratio;
  ctx.setTransform(ratio,0,0,ratio,0,0);
}
window.addEventListener('resize', ()=>{ fitCanvas(); adaptResolution(); });
adaptResolution();

/* start */
startMusic();

/* accessibility: restart with R key */
window.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='r') resetGame(); });

</script>
</body>
</html>
